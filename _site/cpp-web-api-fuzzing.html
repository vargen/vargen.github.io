<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>CPP Web API Fuzzing - Code Intelligence Docs</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>CPP Web API Fuzzing | Code Intelligence Docs</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="CPP Web API Fuzzing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation site for Code Intelligence products." /> <meta property="og:description" content="Documentation site for Code Intelligence products." /> <link rel="canonical" href="http://localhost:4000/cpp-web-api-fuzzing" /> <meta property="og:url" content="http://localhost:4000/cpp-web-api-fuzzing" /> <meta property="og:site_name" content="Code Intelligence Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="CPP Web API Fuzzing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation site for Code Intelligence products.","headline":"CPP Web API Fuzzing","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/ci_logo.png"}},"url":"http://localhost:4000/cpp-web-api-fuzzing"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/cifuzz-cli" class="nav-list-link">CI Fuzz CLI</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/cli-installation" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-quick-start-cpp" class="nav-list-link">Quick Start C/C++</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-quick-start-java" class="nav-list-link">Quick Start Java</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-initializing-a-project" class="nav-list-link">Initializing a Project</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-creating-a-fuzz-test" class="nav-list-link">Creating a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-running-a-fuzz-test" class="nav-list-link">Running a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-findings" class="nav-list-link">Findings</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-coverage" class="nav-list-link">Coverage</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-remote-run" class="nav-list-link">Remote Run</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/ci-fuzz" class="nav-list-link">CI Fuzz</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-quick-start-cpp" class="nav-list-link">Quick Start C/C++</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-installation" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-authentication" class="nav-list-link">Authentication</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-running-a-fuzz-test" class="nav-list-link">Running a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-access-control" class="nav-list-link">Access Control</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-project-creation" class="nav-list-link">Project Creation</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-findings" class="nav-list-link">Findings</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/web-api-fuzzing" class="nav-list-link">Web API Fuzzing</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/java-web-api-fuzzing" class="nav-list-link">Java Web API Fuzzing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/go-web-api-fuzzing" class="nav-list-link">Go Web API Fuzzing</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/cpp-web-api-fuzzing" class="nav-list-link active">CPP Web API Fuzzing</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Code Intelligence Docs" aria-label="Search Code Intelligence Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/CodeIntelligenceTesting/cifuzz" class="site-button" target="_blank" rel="noopener noreferrer" > CI Fuzz CLI </a> </li> <li class="aux-nav-list-item"> <a href="//code-intelligence.com" class="site-button" target="_blank" rel="noopener noreferrer" > Code Intelligence </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/ci-fuzz">CI Fuzz</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/web-api-fuzzing">Web API Fuzzing</a></li> <li class="breadcrumb-nav-list-item"><span>CPP Web API Fuzzing</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="c-web-api-fuzzing"> <a href="#c-web-api-fuzzing" class="anchor-heading" aria-labelledby="c-web-api-fuzzing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>C++ Web API Fuzzing</strong> </h1> <p>CI Fuzz is capable of coverage-guided fuzzing for C++ based REST and GRPC APIs. This section will guide you through the initial setup of a C++ Web API fuzzing project.</p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ul id="markdown-toc"> <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li> <li><a href="#web-api-server" id="markdown-toc-web-api-server">Web API Server</a></li> <li><a href="#create-a-fuzz-test" id="markdown-toc-create-a-fuzz-test">Create a Fuzz Test</a></li> <li><a href="#add-a-web-service" id="markdown-toc-add-a-web-service">Add a Web Service</a></li> <li><a href="#compile-c-bug-detector-framework" id="markdown-toc-compile-c-bug-detector-framework">Compile C++ Bug Detector Framework</a> <ul> <li><a href="#air-gapped-environments" id="markdown-toc-air-gapped-environments">Air Gapped Environments</a></li> <li><a href="#build" id="markdown-toc-build">Build</a></li> </ul> </li> <li><a href="#instrument-your-code-for-fuzzing" id="markdown-toc-instrument-your-code-for-fuzzing">Instrument your Code for Fuzzing</a> <ul> <li><a href="#running-the-instrumented-binary" id="markdown-toc-running-the-instrumented-binary">Running the Instrumented Binary</a></li> </ul> </li> <li><a href="#example-run-script" id="markdown-toc-example-run-script">Example Run Script</a></li> </ul><hr /> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <p>Before you proceed with this guide, you should have already:</p> <ul> <li><a href="/ci-fuzz-installation">Installed CI Fuzz</a> and the build tools.</li> <li><a href="/ci-fuzz-authentication">Configured authentication</a>.</li> <li><a href="/ci-fuzz-project-creation">Created a project</a>.</li> <li><a href="/web-api-fuzzing">Configured your Web API using the template</a>.</li> <li>Received the C++ bug detector framework from Code Intelligence.</li> </ul> <h2 id="web-api-server"> <a href="#web-api-server" class="anchor-heading" aria-labelledby="web-api-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Web API Server </h2> <p>Your Web API can run anywhere as long as it is reachable from the server hosting CI Fuzz. Port details are provided below.</p> <p>Typically, this would be one of the following:</p> <ul> <li>On the CI/CD server (gitlab/github/jenkins server)</li> <li>On the CI Fuzz server</li> <li>A separate server (e.g. your integration testing cluster)</li> </ul> <p>If you choose to run your Web API on a separate server from the one hosting CI Fuzz, you need to make sure that:</p> <ol> <li>The Web API is exposed on a network interface and the port on which it is running is reachable from CI Fuzz.</li> <li>Ports 443 or 80 and 6777-7777 on the server running CI Fuzz are reachable from the server hosting your Web API.</li> </ol> <h2 id="create-a-fuzz-test"> <a href="#create-a-fuzz-test" class="anchor-heading" aria-labelledby="create-a-fuzz-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a Fuzz Test </h2> <p>You should have already created a fuzz test based on <a href="/web-api-fuzzing">the provided template</a>.</p> <h2 id="add-a-web-service"> <a href="#add-a-web-service" class="anchor-heading" aria-labelledby="add-a-web-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Add a Web Service </h2> <p>CI Fuzz uses the idea of web services to associate fuzz tests to a given service when the fuzzing agent contacts CI Fuzz from the software under test. Web services can be created in the UI with the following steps:</p> <ol> <li>Open CI Fuzz in your browser</li> <li>From the left sidebar, select your project from the dropdown menu.</li> <li>Click <strong>Project Settings</strong></li> <li>Click <strong>WEB SEVICES</strong></li> <li>Click the <strong>ADD WEB SERVICE</strong> button.</li> <li>Add a name in the <strong>Web Service Identifier</strong> textbox. The name/identifier can be whatever you like, but it must match the name in the <code class="language-plaintext highlighter-rouge">.code-intelligence/web_services.yaml</code> file. If you used the template project, the name is <code class="language-plaintext highlighter-rouge">mywebservice</code> by default.</li> <li>Click <strong>NEXT</strong>.</li> <li>Select <strong>C/C++</strong></li> <li>If you have not already, you can download the fuzzing agent by clicking <strong>DOWNLOAD NATIVE FUZZING AGENT</strong>. You can also download the fuzzing agent at any time by running <code class="language-plaintext highlighter-rouge">cictl get nativeagent</code>.</li> <li>If you have not already, you can download the static support library by clicking <strong>DOWNLOAD STATIC SUPPORT LIBRARY</strong>. You can also download the static support library at any by running <code class="language-plaintext highlighter-rouge">cictl get fuzzingsupportlib</code>.</li> <li>Click <strong>DONE</strong></li> </ol> <h2 id="compile-c-bug-detector-framework"> <a href="#compile-c-bug-detector-framework" class="anchor-heading" aria-labelledby="compile-c-bug-detector-framework"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compile C++ Bug Detector Framework </h2> <p>The C++ bug detector framework is a framework to hook into C and C++ code with the goal of detecting bugs via CI Fuzz. It is provided as a CMake project so that users can build it with their compiler, using their C++ runtime. The final artifact is a shared object, <code class="language-plaintext highlighter-rouge">libhooks.so</code>, which is meant to be preloaded into the application under test. Currently, only Linux is supported.</p> <h3 class="no_toc" id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h3> <ul> <li>C++ 17+ compiler toolchain.</li> <li>If detectors with external dependencies are activated during build an internet connection to download them is necessary.</li> </ul> <h3 id="air-gapped-environments"> <a href="#air-gapped-environments" class="anchor-heading" aria-labelledby="air-gapped-environments"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Air Gapped Environments </h3> <p>If you are building this framework in an airgapped environment, you will need to download the dependencies manually and place them in the folders where CMake expects them. Download all files referenced in CMakeLists.txt by <code class="language-plaintext highlighter-rouge">ExternalProject_Add</code> URL and place them in <build-dir>/<project-name>-prefix/src/external-project-url-downloaded-file&gt;.</project-name></build-dir></p> <p>For the sql-parser dependency this would be build/sql-parser-prefix/src/f0faaad39904f7756d1a8becf798a96e444351d0.zip downloaded from https://github.com/CodeIntelligenceTesting/sql-parser/archive/f0faaad39904f7756d1a8becf798a96e444351d0.zip</p> <h3 id="build"> <a href="#build" class="anchor-heading" aria-labelledby="build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Build </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=RELEASE ..
cmake --build .
</code></pre></div></div> <p><strong>Note</strong>: Optional detectors will be enabled depending on your build environment. The CMake configuration process reports for each optional detector whether it’s enabled, and why. For example, if you have a license for SQLAPI++, you can enable the SQL injection detector by pointing CMake to your SQLAPI.h using -DCMAKE_INCLUDE_PATH=/path/to/sqlapi/include.</p> <p>External dependency for all detectors: sql-parser</p> <ul> <li>SQLAPI++ <ul> <li>Deactivated by default; to enable set -DCMAKE_INCLUDE_PATH=/path/to/sqlapi/include</li> <li>Tests require SQLAPI++, point CMake to it with -DCMAKE_LIBRARY_PATH=/path/to/sqlapi/lib</li> </ul> </li> <li>SQLite <ul> <li>Enabled by default; to disable set -DENABLE_SQLITE=OFF</li> <li><code class="language-plaintext highlighter-rouge">libsqlit3</code> required on build system</li> </ul> </li> </ul> <p>After building the framework, you will have the <code class="language-plaintext highlighter-rouge">libhooks.so</code> file that you can preload with your application under test when you run it.</p> <h2 id="instrument-your-code-for-fuzzing"> <a href="#instrument-your-code-for-fuzzing" class="anchor-heading" aria-labelledby="instrument-your-code-for-fuzzing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instrument your Code for Fuzzing </h2> <p>Add the following flags to your compilation step:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-fprofile-instr-generate -fcoverage-mapping -fsanitize=fuzzer-no-link -Lpath/to/downloaded/agent -Wl,-rpath,path/to/downloaded/agent -lfuzzing_agent
</code></pre></div></div> <p>Add the following flags to your linker step:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-fprofile-instr-generate -fsanitize=fuzzer-no-link -L${CIFUZZ_DIR}/lib/code-intelligence -Wl,-rpath,${CIFUZZ_DIR}/lib/code-intelligence -lfuzzing_agent
</code></pre></div></div> <p>Link the static support library with your binary with the following flags:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Wl,--whole-archive path/to/downloaded/libfuzzing_support_lib.a -Wl,--no-whole-archive
</code></pre></div></div> <h3 id="running-the-instrumented-binary"> <a href="#running-the-instrumented-binary" class="anchor-heading" aria-labelledby="running-the-instrumented-binary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the Instrumented Binary </h3> <p>Before you start your fuzz test, you need to start the instrumented binary you created. This binary requires some environment variables so that the agent (<code class="language-plaintext highlighter-rouge">libfuzzing_agent.so</code>) knows how to reach CI Fuzz. There are several environment variables you can provide when invoking the instrumented binary. Most of them are required:</p> <ul> <li>ASAN_OPTIONS=alloc_dealloc_mismatch=0 - deactivates allocation checks that would be triggered in the hook.</li> <li>LD_PRELOAD - path to the <code class="language-plaintext highlighter-rouge">libhooks.so</code> when you <a href="#build">built the bug detector framework</a>. This is required.</li> <li>CIFUZZ_AUTH_TOKEN - API token or password you configured when you <a href="/ci-fuzz-authentication">configured authentication</a>.</li> <li>CIFUZZ_SERVICE_NAME - the full <a href="#add-a-web-service">web service you added</a>. This can be obtained by running <code class="language-plaintext highlighter-rouge">cictl list webservices</code> and copying the appropriate one. Be sure to copy the full path. It should be of the form <code class="language-plaintext highlighter-rouge">projects/&lt;project_name&gt;/web_services/&lt;web_service_name&gt;</code>.</li> <li>CIFUZZ_FUZZING_SERVER_HOST - the IP or domain where CI Fuzz is reachable.</li> <li>CIFUZZ_FUZZING_SERVER_PORT - the port where CI Fuzz is reachable.</li> <li>CIFUZZ_TLS - if CI Fuzz is configured with TLS, this should be set to 1.</li> <li>CIFUZZ_TLS_CERT_FILE - if you are using a custom certificate, specify the path here.</li> <li>CIFUZZ_HALT_ON_ERROR - a discovered bug does not exit the application by default. If you want the application to halt on errors, set this variable to 1.</li> </ul> <p><strong>Warning</strong>: If TLS is enabled for CI Fuzz and <code class="language-plaintext highlighter-rouge">CIFUZZ_TLS</code> is not set to 1, the connection will fail.</p> <p>Example of running the instrumented binary with appropriate environment variables:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ASAN_OPTIONS</span><span class="o">=</span><span class="nv">alloc_dealloc_mismatch</span><span class="o">=</span>0 <span class="se">\</span>
<span class="nv">LD_PRELOAD</span><span class="o">=</span>/home/demo/cpp-bug-detector-framework/build/libhooks.so <span class="se">\</span>
<span class="nv">CIFUZZ_TLS</span><span class="o">=</span>1 <span class="se">\</span>
<span class="nv">CIFUZZ_AUTH_TOKEN</span><span class="o">=</span>d24573f2-b6d5-4180-9ce6-9a93872942ad <span class="se">\</span>
<span class="nv">CIFUZZ_SERVICE_NAME</span><span class="o">=</span>projects/cpp-web-app-4d9d77bd/web_services/cpp-sql-service <span class="se">\</span>
<span class="nv">CIFUZZ_FUZZING_SERVER_PORT</span><span class="o">=</span>8080 <span class="se">\</span>
<span class="nv">CIFUZZ_FUZZING_SERVER_HOST</span><span class="o">=</span>127.0.0.1 <span class="se">\</span>
/home/demo/repos/cpp-web-app/web-app-demo
</code></pre></div></div> <h2 id="example-run-script"> <a href="#example-run-script" class="anchor-heading" aria-labelledby="example-run-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example Run Script </h2> <p>The following is an example run script for running the fuzz tests for a gRPC project. This can also be used as the basis for a CI/CD script to automate the fuzzing process.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /usr/bin/bash</span>

<span class="c"># duration to monitor the campaign run</span>
<span class="nv">TIMEOUT</span><span class="o">=</span>120
<span class="c"># type of findings to report</span>
<span class="nv">FINDINGS_TYPE</span><span class="o">=</span>CRASH,RUNTIME_ERROR
<span class="c"># [IP | DOMAIN]:PORT where CI Fuzz is currently reachable</span>
<span class="nv">FUZZING_SERVER</span><span class="o">=</span>
<span class="c"># http[s]://[IP | DOMAIN]:PORT where CI Fuzz is currently reachable</span>
<span class="nv">WEB_APP_ADDRESS</span><span class="o">=</span>
<span class="c"># project name obtained from: cictl list projects</span>
<span class="nv">PROJECT</span><span class="o">=</span>
<span class="c"># API token (or password) you configured for connecting to CI Fuzz</span>
<span class="nv">CI_FUZZ_API_TOKEN</span><span class="o">=</span>
<span class="c"># path to the root of the local repository</span>
<span class="nv">LOCAL_REPO</span><span class="o">=</span>
<span class="c"># [IP | DOMAIN]:PORT where the target API is running</span>
SOFTWARE_UNDER_TEST

<span class="c"># build the artifacts to submit to CI Fuzz</span>
<span class="nb">cd</span> <span class="nv">$LOCAL_REPO</span>
ci-build fuzzers <span class="nt">--directory</span><span class="o">=</span>./
<span class="nb">mkdir </span>fuzzing_artifacts

<span class="c"># authenticate to the fuzzing server</span>
<span class="nv">CICTL_CMD</span><span class="o">=</span><span class="s2">"cictl -s </span><span class="nv">$FUZZING_SERVER</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nv">$CI_FUZZ_API_TOKEN</span> | <span class="nv">$CICTL_CMD</span> login

<span class="c"># import the artifact bundle to CI Fuzz</span>
<span class="nv">ARTIFACT_NAME</span><span class="o">=</span><span class="si">$(</span><span class="nv">$CICTL_CMD</span> import artifact <span class="nv">$LOCAL_REPO</span>/fuzzing-artifacts.tar.gz <span class="nt">--project-name</span> <span class="s2">"</span><span class="nv">$PROJECT</span><span class="s2">"</span><span class="si">)</span>

<span class="c"># start the fuzz tests</span>
<span class="nv">TEST_COLLECTION_RUN</span><span class="o">=</span><span class="si">$(</span><span class="nv">$CICTL_CMD</span> start <span class="nt">--application-base-url</span> <span class="nv">$SOFTWARE_UNDER_TEST</span> <span class="s2">"</span><span class="k">${</span><span class="nv">ARTIFACT_NAME</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span>

<span class="c"># monitor the output of the run</span>
<span class="nv">$CICTL_CMD</span> monitor_campaign_run <span class="nt">--dashboard_address</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WEB_APP_ADDRESS</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--duration</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">TIMEOUT</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--findings_type</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">FINDINGS_TYPE</span><span class="k">}</span><span class="s2">"</span> <span class="k">${</span><span class="nv">TEST_COLLECTION_RUN</span><span class="k">}</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
