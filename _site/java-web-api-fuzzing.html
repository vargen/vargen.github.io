<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Java Web API Fuzzing - Code Intelligence Docs</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Java Web API Fuzzing | Code Intelligence Docs</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Java Web API Fuzzing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation site for Code Intelligence products." /> <meta property="og:description" content="Documentation site for Code Intelligence products." /> <link rel="canonical" href="http://localhost:4000/java-web-api-fuzzing" /> <meta property="og:url" content="http://localhost:4000/java-web-api-fuzzing" /> <meta property="og:site_name" content="Code Intelligence Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Java Web API Fuzzing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation site for Code Intelligence products.","headline":"Java Web API Fuzzing","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/ci_logo.png"}},"url":"http://localhost:4000/java-web-api-fuzzing"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/cifuzz-cli" class="nav-list-link">CI Fuzz CLI</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/cli-installation" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-quick-start-cpp" class="nav-list-link">Quick Start C/C++</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-quick-start-java" class="nav-list-link">Quick Start Java</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-initializing-a-project" class="nav-list-link">Initializing a Project</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-creating-a-fuzz-test" class="nav-list-link">Creating a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-running-a-fuzz-test" class="nav-list-link">Running a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-findings" class="nav-list-link">Findings</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-coverage" class="nav-list-link">Coverage</a></li><li class="nav-list-item "><a href="http://localhost:4000/cli-remote-run" class="nav-list-link">Remote Run</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/ci-fuzz" class="nav-list-link">CI Fuzz</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-quick-start-cpp" class="nav-list-link">Quick Start C/C++</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-installation" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-authentication" class="nav-list-link">Authentication</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-running-a-fuzz-test" class="nav-list-link">Running a Fuzz Test</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-access-control" class="nav-list-link">Access Control</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-project-creation" class="nav-list-link">Project Creation</a></li><li class="nav-list-item "><a href="http://localhost:4000/ci-fuzz-findings" class="nav-list-link">Findings</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/web-api-fuzzing" class="nav-list-link">Web API Fuzzing</a><ul class="nav-list"><li class="nav-list-item active"> <a href="http://localhost:4000/java-web-api-fuzzing" class="nav-list-link active">Java Web API Fuzzing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/go-web-api-fuzzing" class="nav-list-link">Go Web API Fuzzing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/cpp-web-api-fuzzing" class="nav-list-link">CPP Web API Fuzzing</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Code Intelligence Docs" aria-label="Search Code Intelligence Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/CodeIntelligenceTesting/cifuzz" class="site-button" target="_blank" rel="noopener noreferrer" > CI Fuzz CLI </a> </li> <li class="aux-nav-list-item"> <a href="//code-intelligence.com" class="site-button" target="_blank" rel="noopener noreferrer" > Code Intelligence </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/ci-fuzz">CI Fuzz</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/web-api-fuzzing">Web API Fuzzing</a></li> <li class="breadcrumb-nav-list-item"><span>Java Web API Fuzzing</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="java-web-api-fuzzing"> <a href="#java-web-api-fuzzing" class="anchor-heading" aria-labelledby="java-web-api-fuzzing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Java Web API Fuzzing</strong> </h1> <p>CI Fuzz is capable of coverage-guided fuzzing for Java-based REST and GRPC APIs. This section will guide you through the initial setup of a Java Web API fuzzing project.</p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ul id="markdown-toc"> <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li> <li><a href="#web-api-server" id="markdown-toc-web-api-server">Web API Server</a></li> <li><a href="#configure-java-agent" id="markdown-toc-configure-java-agent">Configure Java Agent</a> <ul> <li><a href="#java-agent-parameters" id="markdown-toc-java-agent-parameters">Java Agent Parameters</a></li> </ul> </li> <li><a href="#example-cicd-script" id="markdown-toc-example-cicd-script">Example CI/CD Script</a></li> </ul><hr /> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <p>Before you proceed with this guide, you should have already:</p> <ul> <li><a href="/ci-fuzz-installation">Installed CI Fuzz</a> and the build tools.</li> <li><a href="/ci-fuzz-authentication">Configured authentication</a>.</li> <li><a href="/ci-fuzz-project-creation">Created a project</a>.</li> <li><a href="/web-api-fuzzing">Configured your Web API using the template</a>.</li> </ul> <h2 id="web-api-server"> <a href="#web-api-server" class="anchor-heading" aria-labelledby="web-api-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Web API Server </h2> <p>Your Web API can run anywhere as long as it is reachable from the server hosting CI Fuzz. Port details are provided below.</p> <p>Typically, this would be one of the following:</p> <ul> <li>On the CI/CD server (gitlab/github/jenkins server)</li> <li>On the CI Fuzz server</li> <li>A separate server (e.g. your integration testing cluster)</li> </ul> <p>If you choose to run your Web API on a separate server from the one hosting CI Fuzz, you need to make sure that:</p> <ol> <li>The Web API is exposed on a network interface and the port on which it is running is reachable from CI Fuzz.</li> <li>Ports 443 or 80 and 6777-7777 on the server running CI Fuzz are reachable from the server hosting your Web API.</li> </ol> <h2 id="configure-java-agent"> <a href="#configure-java-agent" class="anchor-heading" aria-labelledby="configure-java-agent"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure Java Agent </h2> <p>The <code class="language-plaintext highlighter-rouge">javaagent</code> is responsible for instrumenting the Web API to collect coverage information. This coverage information is sent back to CI Fuzz to help it determine which code paths to follow and how to mutate the inputs to your Web API. The CI Fuzz Agent is deployed with your Web API.</p> <p>CI Fuzz will provide the command line argument that is needed to deploy the agent alongside your target application:</p> <ol> <li>Open CI Fuzz in your browser</li> <li>From the left sidebar, select your project from the dropdown menu.</li> <li>Click <strong>Project Settings</strong></li> <li>Click <strong>WEB SEVICES</strong></li> <li>Click the <strong>ADD WEB SERVICE</strong> button.</li> <li>Add a name in the <strong>Web Service Identifier</strong> textbox. The name/identifier can be whatever you like, but it must match the name in the <code class="language-plaintext highlighter-rouge">.code-intelligence/web_services.yaml</code> file. If you used the template project, the name is <code class="language-plaintext highlighter-rouge">mywebservice</code> by default.</li> <li>If the target application is not running on the same server as CI Fuzz, click <strong>Use Custom Fuzzing Server Settings</strong> to specify the host and port where the CI Fuzz Agent can reach CI Fuzz. The host</li> <li>Click <strong>NEXT</strong>.</li> <li>Select <strong>JAVA</strong></li> <li>Copy the appropriate command line argument (depending on if your application uses JAVA_OPTS or not).</li> </ol> <p>Here is an example <code class="language-plaintext highlighter-rouge">javaagent</code> argument string:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-javaagent:path/to/downloaded/fuzzing_agent.jar=service_name=projects/webgoat-27096bd3/web_services/mywebservice,fuzzing_server_host=grpc.code-intelligence.com,fuzzing_server_port=443,api_token=$CI_FUZZ_API_TOKEN,cert_file=$CERT_FILE,tls=true
</code></pre></div></div> <h3 id="java-agent-parameters"> <a href="#java-agent-parameters" class="anchor-heading" aria-labelledby="java-agent-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Java Agent Parameters </h3> <p>The <code class="language-plaintext highlighter-rouge">javaagent</code> supports the following parameters:</p> <ul> <li> <p><strong>path/to/downloaded/fuzzing_agent.jar</strong> - set the path of the <code class="language-plaintext highlighter-rouge">javaagent</code>. The <code class="language-plaintext highlighter-rouge">javaagent</code> must be available to the Web API The recommended way to acquire the <code class="language-plaintext highlighter-rouge">javaagent</code> (fuzzing_agent.jar) is to use the command <code class="language-plaintext highlighter-rouge">cictl get javaagent</code> to download it. There is an example of this below.</p> </li> <li> <p><strong>service_name</strong> - a name which should be unique to be distinguishable from other services e.g. <code class="language-plaintext highlighter-rouge">service_name=projects/example-9070daab/web_services/example</code>. This is typically generated for you by CI Fuzz during web service creation.</p> </li> <li> <p><strong>api_token</strong> - the <code class="language-plaintext highlighter-rouge">javaagent</code> needs the CI Fuzz API token to authenticate to CI Fuzz.</p> </li> <li> <p><strong>instrumentation_includes</strong> - a <code class="language-plaintext highlighter-rouge">:</code> separated list of package glob patterns to include in the instrumentation e.g. <code class="language-plaintext highlighter-rouge">instrumentation_includes=com.google.**:com.example.**</code>. Only the feedback that is received for the specified package patterns will affect the fuzzing input generation and path discovery of the code. Though not technically required, failure to specify will result in the <code class="language-plaintext highlighter-rouge">javaagent</code> instrumenting all packages (including native Java packages). This typically results in the JVM running out of memory as well as the fuzzer spending time exploring packages that you may not be interested in.</p> </li> <li> <p><strong>instrumentation_excludes</strong> - a <code class="language-plaintext highlighter-rouge">:</code> separated list of package glob patterns to exclude from the instrumentation.</p> </li> <li> <p><strong>tls</strong> - set to <code class="language-plaintext highlighter-rouge">true</code> if CI Fuzz has TLS enabled, otherwise set to <code class="language-plaintext highlighter-rouge">false</code>. When <code class="language-plaintext highlighter-rouge">true</code>, this will encrypt the communication between CI Fuzz and the <code class="language-plaintext highlighter-rouge">javaagent</code>. The gRPC communication between the fuzzer and <code class="language-plaintext highlighter-rouge">javaagent</code> is still unencrypted.</p> </li> <li> <p><strong>cert_file</strong> - The location of the certificate of the CA that signed the TLS certificate of the CI Fuzz server. Only required if the cert is not signed by a public CA.</p> </li> <li> <p><strong>fuzzing_server_host</strong> - use a host name that is listed in the server’s TLS certificate, otherwise the TLS connection will fail.</p> </li> <li> <p><strong>fuzzing_server_port</strong> - port where CI Fuzz can be reached.</p> </li> </ul> <h2 id="example-cicd-script"> <a href="#example-cicd-script" class="anchor-heading" aria-labelledby="example-cicd-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example CI/CD Script </h2> <p>This is an example Gitlab CI job that will start a Java Web API with <code class="language-plaintext highlighter-rouge">javaagent</code> on another server. In this example, the deployment server already has the cictl tool and uses it to download the <code class="language-plaintext highlighter-rouge">javaagent</code>. You can also download the java agent in the CI/CD pipeline and then copy it to the deployment server.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deploy:  
  stage: deploy  
  image: cifuzz/ubuntu-ssh  
  before_script:  
    - eval $(ssh-agent -s)  
    - echo ""$SSH_PRIVATE_KEY"" | tr -d '\\r' | ssh-add -  
    - mkdir -p ~/.ssh  
    - chmod 700 ~/.ssh  
    - echo ""$SSH_KNOWN_HOSTS"" &gt;&gt; ~/.ssh/known_hosts  
    - chmod 644 ~/.ssh/known_hosts  
  variables:  
    DEPLOY_HOST: azureuser@on-prem-l000003  
  script:  
    - echo ""Kill currently running app...""  
    - ssh $DEPLOY_HOST pkill -f rest-service || true  
    - echo ""Copy app binary...""  
    - ls build/libs  
    - scp build/libs/rest-service-?.?.?.jar $DEPLOY_HOST:~  
    - echo ""Prepare CA certificate for connecting to CI Fuzz...""  
    - cat $CA_CERT  
    - scp $CA_CERT $DEPLOY_HOST:~/CA.pem  
    - echo ""download correct version of java agent from CI Fuzz server""  
    - ssh $DEPLOY_HOST ""echo $CI_FUZZ_API_TOKEN | ./cictl login -s $FUZZING_SERVER""  
    - ssh $DEPLOY_HOST ""./cictl get javaagent -s $FUZZING_SERVER""  
    - echo ""Run app...""  
    - FUZZING_SERVER_HOST=$(echo $FUZZING_SERVER|cut -d ':' -f 1)  
    - FUZZING_SERVER_PORT=$(echo $FUZZING_SERVER|cut -d ':' -f 2)  
    - echo "java -javaagent:fuzzing_agent.jar=fuzzing_server_host=$FUZZING_SERVER_HOST,fuzzing_server_port=$FUZZING_SERVER_PORT,service_name=$PROJECT/web_services/mywebservice,api_token=$CI_FUZZ_API_TOKEN,cert_file=CA.pem,instrumentation_includes=\\""com.cifuzzexample.\*\*\\""  -Dserver.port=$SUT_PORT -jar rest-service-\*.jar &gt; output.log 2&gt;&amp;1 &amp;" &gt; javacommand  
    - scp javacommand $DEPLOY_HOST:~  
    - ssh $DEPLOY_HOST ""chmod u+x javacommand &amp;&amp; ./javacommand""
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
